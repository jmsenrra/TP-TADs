\documentclass[10pt, a4paper]{article}
\usepackage[paper=a4paper, left=1.5cm, right=1.5cm, bottom=1.5cm, top=3.5cm]{geometry}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish]{babel}
\usepackage{indentfirst}
\usepackage{fancyhdr}
\usepackage{latexsym}
\usepackage{lastpage}
\usepackage{aed2-symb,aed2-itef,aed2-tad}
\usepackage[colorlinks=true, linkcolor=blue]{hyperref}
\usepackage{calc}

\deactivatequoting

\newcommand{\f}[1]{\text{#1}}
\renewcommand{\paratodo}[2]{$\forall~#2$: #1}

\sloppy

\hypersetup{%
 % Para que el PDF se abra a página completa.
 pdfstartview= {FitH \hypercalcbp{\paperheight-\topmargin-1in-\headheight}},
 pdfauthor={Grupo x},
 pdfkeywords={TAD Mapa y TAD Campus},
 pdfsubject={TP TADs}
}

\parskip=5pt % 10pt es el tamaño de fuente

% Pongo en 0 la distancia extra entre ítemes.
\let\olditemize\itemize
\def\itemize{\olditemize\itemsep=0pt}

% Acomodo fancyhdr.
\pagestyle{fancy}
\thispagestyle{fancy}
\addtolength{\headheight}{1pt}
\lhead{Algoritmos y Estructuras de Datos II}
\rhead{$2^{\mathrm{er}}$ cuatrimestre de 2015}
\cfoot{\thepage /\pageref{LastPage}}
\renewcommand{\footrulewidth}{0.4pt}

\author{Grupo x}
\date{}
\title{TAD Mapa y TAD Campus}

\begin{document}

\begin{tad}{\tadNombre{Posición} es \tadNombre{Tupla(nat $\times$ nat)}}

\end{tad} %no sé cómo borrar el Fin TAD

\begin{tad}{\tadNombre{Agente} es \tadNombre{Tupla(nat $\times$ nat $\times$ nat)}}

\end{tad}


\begin{tad}{\tadNombre{Mapa}}
\tadGeneros{map}
\tadExporta{}
\tadUsa{\tadNombre{}}
\tadIgualdadObservacional{}{}{}{}

\tadAlinearFunciones{posicionesAMenorDistanciaAux}{nat /al, nat /an,conj(tupla(nat, nat)/obstaculos}

\tadObservadores
\tadOperacion{obstáculos}{map}{conj (posición)}{}
\tadOperacion{ancho}{map}{nat}{}
\tadOperacion{alto}{map}{nat}{}

\tadGeneradores
\tadOperacion{nuevoMapa}{nat /al, nat /an,conj(tupla(nat, nat)/obstaculos}{map}{$ (al \geq 1) \land(an \geq 1) \land ((\forall :o\hspace{0,1cm}tupla(nat\hspace{0,1cm} , \hspace{0,1cm}nat)) \hspace{0,1cm} o \in obstaculos \iff 1 \leq \Pi_1(o)\leq an \land 1 \leq \Pi_2(o)\leq al) $ }

\tadOtrasOperaciones
\tadOperacion{Distancia}{posición,posición}{nat (origen,destino)}{}
\tadOperacion{Izquierda}{posición}{posición}{}
\tadOperacion{Derecha}{posición}{posición}{}
\tadOperacion{Arriba}{posición}{posición}{}
\tadOperacion{Abajo}{map,posición}{bool}{}
\tadOperacion{FueraDelMapa}{posición}{posición}{}
\tadOperacion{PosicionesAMenorDistancia}{posición,conj(posición)}{conj(posición)}{}
\tadOperacion{PosicionesAMenorDistanciaAux}{posición,conj(posición)}{conj(posición)}{}
\tadOperacion{TodosALaMismaDistancia}{posición /p,conj(posición) /ps}{bool}{$\neg \emptyset$?($ps$)}
\tadOperacion{TodosALaMismaDistanciaAux}{posición /p,conj(posición) /ps}{bool}{$\neg \emptyset$?($ps$)}
\tadOperacion{HayUnoAMenorDistancia}{posición /p1,posición /p2,conj(posición) /ps}{bool}{$\neg \emptyset$?($ps$)}
\tadOperacion{EstáArriba?}{posición,posición}{bool}{}
\tadOperacion{EstáAbajo?}{posicion,posición}{bool}{}
\tadOperacion{EstáALaDerecha?}{posición,posición}{bool}{}
\tadOperacion{EstáALaIzquierda?}{posición,posición}{bool}{}
\tadOperacion{EstáEnLaPrimerDiagonal?}{posición,posición}{bool}{}
\tadOperacion{EstáEnLaSegundaDiagonal?}{posición,posición}{bool}{}
\tadOperacion{EstáEnLaTercerDiagonal?}{posición,posición}{bool}{}
\tadOperacion{EstáEnLaCuartaDiagonal?}{posición,posición}{bool}{}

\tadAxiomas[\paratodo{}{}]

\tadAlinearAxiomas{obstaculos(nuevoMapa(al,an,obstaculos))}

\tadAxioma{obstaculos(nuevoMapa(al,an,obstaculos))}{obstaculos}
\tadAxioma{ancho(nuevoMapa(al,an))}{an}
\tadAxioma{alto(nuevoMapa(al,an))}{an}
\tadAxioma{Distancia ($v_1,v_2$)}{$max(\Pi_1(v_1),\Pi_1(v_2))- min(\Pi_1(v_1),\Pi_1(v_2))
$}
\tadAxioma {Izquierda(p)} {$\langle pred(\Pi_1(p)),\Pi_2(p) \rangle$}
\tadAxioma {Derecha(p)} {$\langle suc(\Pi_1(p)),\Pi_2(p) \rangle$}
\tadAxioma {Arriba(p)} {$\langle \Pi_1(p),pred (\Pi_2(p)) \rangle$}
\tadAxioma {Abajo(p)} {$\langle \Pi_1(p), suc(\Pi_2(p)) \rangle$}
\tadAxioma {FueraDelMapa(m,p)} {$\Pi_1(p)<1 \lor \Pi_2(p)<1 \lor ancho(m)<\Pi_1(p) \lor alto(m)<\Pi_2(p)$}

\end{tad}

\begin{tad}{\tadNombre{Campus}}
\tadIgualdadObservacional{}{}{}{}

\tadParametrosFormales{
    \tadEncabezadoInline{}{}
}

\tadGeneros{camp}
\tadExporta{}
\tadUsa{\tadNombre{}}

\tadAlinearFunciones{AgentesMasVigilantesAux}{camp /c,posición /origen, posición /destino}

\tadObservadores 
\tadOperacion{mapa}{camp}{map}{} 
\tadOperacion{estudiantes}{camp}{conj(posición)}{}
\tadOperacion{hippies}{camp}{conj(posición)}{}
\tadOperacion{agentes}{camp}{dicc(posición, agentes) }{}

\tadGeneradores
\tadOperacion{rastrillaje}{map /m, dicc(posición,agente)/a}{camp}{$((p \in claves(a)) \implies 
(\neg(fueraDelMapa(mapa(c), p))) \land \neg(p \in obstaculos(m)))) \land (\forall p1,p2: posicion) ((p1 \neq p2 \land def?(p1, a) \land def? (p2, a)) \implies (\Pi_1(obtener(p1,a)) \neq \Pi_1(obtener(p2, a)) \land \Pi_2(obtener(p1, a)) = 0 \land \Pi_2(obtener(p2, a)) = 0 \land (\Pi_3(obtener(p1, a)) = 0 \land \Pi_3(obtener(p2, a)) = 0)) $}
\tadOperacion{entraH}{camp /c, posición /p}{camp}{R1}
\tadOperacion{entraE}{camp /c, posición /p}{camp}{R1}
\tadOperacion{mueveH}{camp /c ,posición /p}{camp}{$(p \in hippies(c) $}
\tadOperacion{mueveE}{camp /c,posición /origen, posición /destino}{camp}{$ (origen \in estudiantes(c) ) \land (\neg (fueraDelMapa(map(c) \times destino))) $}
\tadOperacion{mueveA}{camp /c, posición /p}{camp}{$ (p \in claves(agentes(c))) \land (\Pi_3 (obtener(p \times agente(c))) < 3)  $}

{$R1:= (1 \leq \Pi_1(p)\leq ancho(m)) \land (\Pi_2(p) = 0 \lor \Pi_2(p) = alto(mapa(c))) \land (\neg(p \in obstaculos(mapa(c)))) \land (\neg(p \in estudiantes(c))) \land (\neg(p \in claves(agentes(c)))) \land (\neg(p \in hippies(c))$}

\tadOtrasOperaciones
\tadOperacion{\#hippies}{camp}{nat}{}
\tadOperacion{\#estudiantes}{camp}{nat}{}
\tadOperacion{AgenteMásVigilante}{camp}{nat}{}
\tadOperacion{AgentesMásVigilantes}{camp,conj(posición)}{conj(posición)}{}
\tadOperacion{AgentesMásVigilantesAux}{camp,conj(posición)}{conj(posición)}{}
\tadOperacion{TodosIgualDeVigilantes}{camp,nat, conj(posición)}{bool}{}
\tadOperacion{HayUnoMásVigilante}{camp,posición, conj(posición)}{bool}{}
\tadOperacion{\#hippiesCerca}{camp,posición}{nat}{}
\tadOperacion{LugarVacío?}{camp,posición}{bool}{}
\tadOperacion{OpcionesDeMovimiento}{camp,posición}{conj(posición)}{}
\tadOperacion{HayUnoAlLado}{camp /c,posición /p, conj(posición) /ps}{bool}{$\neg \emptyset$?($ps$)}
\tadOperacion{NuevaPosición}{camp /c,posición /p, conj(posición) /ps}{posición}{$(p \in hippies(c)) \lor (p \in claves(agentes(c)))) \land \neg (\emptyset?(ps))$}

\tadAxiomas[\paratodo{}{}]

\tadAlinearAxiomas{TodosIgualDeVigilantes(c,capturas,ps)}

\tadAxioma{mapa(rastrillaje(m,a))}{m}
\tadAxioma{mapa(entraH(c,p))}{mapa(c)}
\tadAxioma{mapa(entraE(c,p))}{mapa(c)}
\tadAxioma{mapa(mueveH(c,p))}{mapa(c)}
\tadAxioma{mapa(mueveE(c,p1,p2))}{mapa(c)}
\tadAxioma{mapa(mueveA(c,p))}{mapa(c)}
\tadAxioma{estudiantes(rastrillaje(m,a))}{$\emptyset$}
\tadAxioma{estudiantes(entraH(c,p))}{$\pi_1$(hNuevo(c,p))} 
\tadAxioma{estudiantes(entraE(c,p))}{$\pi_1$(eNuevo(c,p))}
\tadAxioma{estudiantes(mueveH(c,p))}{$\pi_1$(hMovido(c,p,NuevaPosicion(c,p,estudiantes(c))))}
\tadAxioma{estudiantes(mueveE(c,p1,p2))}{$\pi_1$(eMovido(c,p1,p2))}
\tadAxioma{estudiantes(mueveA(c,p))}{$\pi_1$(aMovido(c,p,NuevaPosicion(c,p,hippies(c))))}
\tadAxioma{hippies(rastrillaje(m,a))}{$\emptyset$}
\tadAxioma{hippies(entraH(c,p))}{$\pi_2$(hNuevo(c,p))}
\tadAxioma{hippies(entraE(c,p))}{$\pi_2$(eNuevo(c,p))}
\tadAxioma{hippies(mueveH(c,p))}{$\pi_2$(hMovido(c,p,NuevaPosicion(c,p,estudiantes(c))))}
\tadAxioma{hippies(mueveE(c,p1,p2))}{$\pi_2$(eMovido(c,p1,p2))}
\tadAxioma{hippies(mueveA(c,p))}{ $\pi_2$(aMovido(c,p,NuevaPosicion(c,p,hippies(c))))}
\tadAxioma{agentes(rastrillaje(m,a))}{a}
\tadAxioma{agentes(entraH(c,p))}{pi3(hNuevo(c,p))}
\tadAxioma{agentes(entraE(c,p))}{pi3(eNuevo(c,p))}
\tadAxioma{agentes(mueveH(c,p))}{ $\pi_3$(hMovido(c,p,NuevaPosicion(c,p,estudiantes(c))))}
\tadAxioma{agentes(mueveE(c,p1,p2))}{pi3(eMovido(c,p1,p2))}
\tadAxioma{agentes(mueveA(c,p))}{ $\pi_3$(aMovido(c,p,NuevaPosicion(c,p,hippies(c))))}
\tadAxioma{\#hippies(c)}{\#hippies(c)}
\tadAxioma{\#estudiantes(c)}{\#estudiantes(c)}
\tadAxioma{AgenteMasVigilante(c)}{ 
AgenteConPlacaMasChica(c, AgentesMasVigilantes(c, claves(agentes(c))))}
\tadAxioma{AgentesMasVigilantes(c,ps)}{\IF \#ps > 2 THEN{\IF TodosIgualDeVigilantes(c,$\pi_2$(obtener(dameUno(ps)),agentes(c)),ps) THEN ps ELSE {\IF $\pi_2$(obtener(dameUno(ps),agentes(c))) < $\pi_2$(obtener(dameUno(sinUno(ps)),agentes(c))) THEN AgentesMasVigilantes(c,ps - {dameUno(ps)}) ELSE {\IF $\pi_2$(obtener(dameUno(ps),agentes(c))) > $\pi_2$(obtener(dameUno(sinUno(ps)),agentes(c))) THEN AgentesMasVigilantes(c,ps - {dameUno(sinUno(ps))}) ELSE {\IF HayUnoMasVigilante(c,dameUno(ps),ps) THEN AgentesMasVigilantes(c,sinUno(sinUno(ps))) ELSE {dameUno(sinUno(ps))} $\cup$ {dameUno(ps)} $\cup$ AgentesMasVigilantes(c,sinUno(sinUno(ps))) FI} FI} FI} FI} ELSE AgentesMasVigilantesAux(c,ps)FI}
\tadAxioma{AgentesMasVigilantesAux(c,ps)}{\IF \#ps == 1 THEN ps ELSE {\IF $\pi_2$(obtener(dameUno(ps),agentes(c))) > $\pi_2$(obtener(dameUno(sinUno(ps)),agentes(c))) THEN {dameUno(ps)} ELSE {\IF $\pi_2$(obtener(dameUno(ps),agentes(c))) < $\pi_2$(obtener(dameUno(sinUno(ps)),agentes(c))) THEN {dameUno(sinUno(ps))} ELSE ps FI} FI} FI}
\tadAxioma{TodosIgualDeVigilantes(c,capturas,ps)}{\IF $\pi_2$(obtener(dameUno(ps),agentes(c))) == capturas $\wedge$ $\neg$($\emptyset$?(sinUno(ps))) THEN TodosIgualDeVigilantes(c,capturas,sinUno(ps)) ELSE $\pi_2$(obtener(dameUno(ps),agentes(c))) == capturas FI}
\tadAxioma{HayUnoMasVigilante(c,p,ps)}{\IF $\pi_2$(obtener(dameUno(ps),agentes(c))) > $\pi_2$(obtener(p,agentes(c))) THEN true ELSE {\IF $\neg$($\emptyset$?(sinUno(ps))) THEN HayUnoMasVigilante(c,p,sinUno(ps)) ELSE false FI} FI}
\tadAxioma{AgenteConPlacaMasChica(c,ps)}{}
\tadAxioma{\#hippiesCerca(c,p)}{$\beta$(Arriba(p) $\in$ hippies(c)) + $\beta$(Abajo(p) $\in$ hippies(c)) + $\beta$(Derecha(p) $\in$ hippies(c)) + $\beta$(Izquierda(p) $\in$ hippies(c))}
\tadAxioma{LugarVacío?(c,p)}{$\neg$(p $\in$ estudiantes(c)) $\wedge$ $\neg$(p $\in$ hippies(c)) $\wedge$ $\neg$(p $\in$ claves(agentes(c))) $\wedge$ $\neg$(p $\in$ obstáculos(mapa(c)))}
%estaría bueno poner los ifs en una linea, pero no ome d
\tadAxioma{OpcionesDeMovimiento(c,p)}{({\IF LugarVacío?(c,Arriba(p)) $\wedge$ $\neg$(FueraDelMapa(mapa(c),Arriba(p))) THEN {Arriba(p)} ELSE $\emptyset$? FI}) $\cup$ ({\IF LugarVacío?(c,Abajo(p)) $\wedge$ $\neg$(FueraDelMapa(mapa(c),Abajo(p))) THEN {Abajo(p)} ELSE $\emptyset$? FI}) $\cup$ ({\IF LugarVacío?(c,Derecha(p)) $\wedge$ $\neg$(FueraDelMapa(mapa(c),Derecha(p))) THEN {Derecha(p)} ELSE $\emptyset$? FI}) $\cup$ ({\IF LugarVacío?(c,Izquierda(p)) $\wedge$ $\neg$(FueraDelMapa(mapa(c),Izquierda(p))) THEN {Izquierda(p)} ELSE $\emptyset$? FI})}
\tadAxioma{HayUnoAlLado(c,p,ps)}{\IF \#ps = 1 THEN Distancia(p,dameUno(ps)) = 1 ELSE {\IF Distancia(p,dameUno(ps)) = 1 THEN true ELSE HayUnoAlLado(c,p,sinUno(ps)) FI} FI}

\tadAlinearAxiomas{0}

%busque bastante y no pude dejarlo bien, al menos habria que hacer que salte de pagina. borré el "EstáEnLaCuartaDiagonal?" porque si no está en ninguna de las otras opciones, entonces está ahí, es el último else >>>>>
\tadAxioma{NuevaPosición(c,p,ps)}{\leavevmode \newline \IF HayUnoAlLado(c,p,ps) THEN p ELSE {\IF EstáArriba?(dameUno(PosicionesAMenorDistancia(p,ps)),p) THEN {\IF <$\pi_1$(p),$\pi_2$(p) + 1> $\in$ OpcionesDeMovimiento(c,p) THEN <$\pi_1$(p),$\pi_2$(p) + 1> ELSE dameUno(PosicionesAMenorDistancia(dameUno(PosicionesAMenorDistancia(p,ps)),OpcionesDeMovimiento(c,p))) FI} ELSE {\IF EstáAbajo?(dameUno(PosicionesAMenorDistancia(p,ps)),p) THEN {\IF <$\pi_1$(p),$\pi_2$(p) - 1> $\in$ OpcionesDeMovimiento(c,p) THEN <$\pi_1$(p),$\pi_2$(p) - 1> ELSE dameUno(PosicionesAMenorDistancia(dameUno(PosicionesAMenorDistancia(p,ps)),OpcionesDeMo- \newline vimiento(c,p))) FI} ELSE {\IF EstáALaDerecha?(dameUno(PosicionesAMenorDistancia(p,ps)),p) THEN {\IF <$\pi_1$(p) + 1,$\pi_2$(p)> $\in$ OpcionesDeMovimiento(c,p) THEN <$\pi_1$(p) + 1,$\pi_2$(p)> ELSE dameUno(PosicionesAMenorDistancia(dameUno(PosicionesAMenorDistancia(p,ps)),OpcionesDeMo-  \newline vimiento(c,p))) FI} ELSE {\IF EstáALaIzquierda?(dameUno(PosicionesAMenorDistancia(p,ps)),p) THEN {\IF <$\pi_1$(p) - 1,$\pi_2$(p)> $\in$ OpcionesDeMovimiento(c,p) THEN <$\pi_1$(p) - 1,$\pi_2$(p)> ELSE dameUno(PosicionesAMenorDistancia(dameUno(PosicionesAMenorDistancia(p,ps)),OpcionesDeMo- \newline vimiento(c,p))) FI} ELSE {\IF EstáEnLaPrimerDiagonal?(dameUno(PosicionesAMenorDistancia(p,ps)),p) THEN {\IF dameUno({<$\pi_1$(p) + 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) + 1>}) $\in$ OpcionesDeMovimiento(c,p) THEN dameUno({<$\pi_1$(p) + 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) + 1>}) ELSE {\IF dameUno(sinUno({<$\pi_1$(p) + 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) + 1>})) $\in$ OpcionesDeMovimiento(c,p) THEN dameUno(sinUno({<$\pi_1$(p) + 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) + 1>})) ELSE dameUno(OpcionesDeMovimiento(c,p)) FI} FI} ELSE {\IF 
EstáEnLaSegundaDiagonal?(dameUno(PosicionesAMenorDistancia(p,ps)),p) THEN {\IF dameUno({<$\pi_1$(p) - 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) + 1>}) $\in$ OpcionesDeMovimiento(c,p) THEN dameUno({<$\pi_1$(p) - 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) + 1>}) ELSE {\IF dameUno(sinUno({<$\pi_1$(p) - 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) + 1>})) $\in$ OpcionesDeMovimiento(c,p) THEN dameUno(sinUno({<$\pi_1$(p) - 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) + 1>})) ELSE dameUno(OpcionesDeMovimiento(c,p)) FI} FI} ELSE {\IF 
EstáEnLaTercerDiagonal?(dameUno(PosicionesAMenorDistancia(p,ps)),p) THEN {\IF dameUno({<$\pi_1$(p) - 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) - 1>}) $\in$ OpcionesDeMovimiento(c,p) THEN dameUno({<$\pi_1$(p) - 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) - 1>}) ELSE {\IF dameUno(sinUno({<$\pi_1$(p) - 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) - 1>})) $\in$ OpcionesDeMovimiento(c,p) THEN dameUno(sinUno({<$\pi_1$(p) - 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) - 1>})) ELSE dameUno(OpcionesDeMovimiento(c,p)) FI} FI} ELSE {\IF dameUno({<$\pi_1$(p) + 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) - 1>}) $\in$ OpcionesDeMovimiento(c,p) THEN dameUno({<$\pi_1$(p) + 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) - 1>}) ELSE {\IF dameUno(sinUno({<$\pi_1$(p) + 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) - 1>})) $\in$ OpcionesDeMovimiento(c,p) THEN dameUno(sinUno({<$\pi_1$(p) + 1,$\pi_2$(p)>} $\cup$ {<$\pi_1$(p),$\pi_2$(p) - 1>})) ELSE dameUno(OpcionesDeMovimiento(c,p)) FI} FI} FI} FI} FI} FI} FI} FI} FI} FI}

\tadAlinearAxiomas{TodosIgualDeVigilantes(c,capturas,ps)}

\tadAxioma{a}{a}


\end{tad}

\end{document}
